#!/bin/bash

set -x

set -eo pipefail

virtualenv /opt/app-root

PATH=/opt/app-root/bin:$PATH

source /opt/app-root/bin/activate

pip install --no-cache mod_wsgi Flask flask-restful pymongo

rm -rf /tmp/src/.git*

cp -Rf /tmp/src/. .

rm -rf /tmp/src

if [ -f requirements.txt ]; then
    pip install --no-cache -r requirements.txt
fi

if [ -x ./create ]; then
    ./create
fi
